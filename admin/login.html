<!-- login.html -->
<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin ¬∑ Inici de sessi√≥</title>
  <style>
    :root{
      --bg:#0b1220; --panel:rgba(255,255,255,.03);
      --line:rgba(255,255,255,.10); --muted:#94a3b8;
      --text:#e8edf3; --primary:#3aa4ff;
      --radius:14px;
    }
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      display:grid; place-items:center;
      font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    }
    *,*::before,*::after{ box-sizing:border-box; }

    .card{
      width:min(420px,92vw);
      background:var(--panel); border:1px solid var(--line); border-radius:var(--radius);
      padding:22px 18px 18px; box-shadow:0 10px 30px rgba(0,0,0,.35);
      overflow:hidden;
    }
    h1{ margin:0 0 8px 0; font-size:20px }
    .muted{ color:var(--muted); font-size:13px }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    .field{ display:flex; flex-direction:column; gap:6px; margin-top:12px; width:100% }
    label{ font-size:13px; color:var(--muted) }
    .input{
      width:100%; max-width:100%; min-width:0; display:block;
      padding:10px 12px; border-radius:10px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      color:inherit; outline:none;
    }
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.06); color:inherit;
      padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700; font-size:14px;
    }
    .btn-primary{ background:var(--primary); color:#001428; border:none }
    .btn-ghost{ background:transparent }
    .msg{ margin-top:10px; font-size:13px }
    .msg.error{ color:#fecaca }
    .msg.ok{ color:#bbf7d0 }
    .sep{ height:1px; background:var(--line); margin:14px 0 }
    .footer{ display:flex; justify-content:space-between; gap:8px; align-items:center; margin-top:6px }
    .small{ font-size:12px }
  </style>
</head>
<body>
  <main class="card">
    <h1>üîê Inici de sessi√≥ Cartells i protocols BSA</h1>
    <div class="muted">Acc√©s a l‚Äôadministraci√≥</div>

    <form id="loginForm" autocomplete="on">
      <div class="field">
        <label for="email">Correu electr√≤nic</label>
        <input id="email" name="email" class="input" type="email" placeholder="usuari@exemple.cat" required />
      </div>

      <div class="field">
        <label for="password">Contrasenya</label>
        <input id="password" name="password" class="input" type="password" placeholder="********" required />
      </div>

      <div class="row" style="margin-top:14px">
        <button id="btnLogin" class="btn btn-primary" type="submit">Entrar</button>
        <button id="btnClear" class="btn btn-ghost" type="button">Neteja</button>
      </div>
    </form>

    <!-- Missatge en lloc de recuperar contrasenya -->
    <div class="sep"></div>
    <div class="msg muted">
      En cas de requerir un canvi de contrasenya, posa‚Äôt en contacte amb l‚Äô<b>equip d‚ÄôInnovaci√≥ de BSA</b>.
    </div>

    <div id="msg" class="msg error" role="alert" aria-live="polite"></div>
    <div id="ok"  class="msg ok"    role="status" aria-live="polite"></div>

    <div class="footer">
      <span class="small muted">¬© Dep. Innovaci√≥ i Projectes</span>
      <a class="small muted" href="../index.html">‚Üê Tornar</a>
    </div>
  </main>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL  = (window.ENV_SUPABASE_URL  || "https://wnkgzpgagprncbtqnzrw.supabase.co").trim();
    const SUPABASE_ANON = (window.ENV_SUPABASE_ANON || "‚Ä¶").trim();
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON, {
      auth: { persistSession:true, autoRefreshToken:true, detectSessionInUrl:true }
    });

    const form = document.getElementById('loginForm');
    const emailEl = document.getElementById('email');
    const passEl  = document.getElementById('password');
    const msgEl = document.getElementById('msg');
    const okEl  = document.getElementById('ok');

    const clearMsgs = () => { msgEl.textContent=""; okEl.textContent=""; };

    form.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      clearMsgs();
      const email = (emailEl.value||"").trim();
      const password = passEl.value||"";
      if (!email || !password){ msgEl.textContent="Omple el correu i la contrasenya."; return; }

      try{
        const { error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) throw error;
        okEl.textContent = "Sessi√≥ iniciada!";
        const params = new URLSearchParams(location.search);
        const to = params.get("redirect") || "./index.html";
        setTimeout(()=>location.replace(to), 200);
      } catch(e){
        msgEl.textContent = e?.message || "Error d‚Äôautenticaci√≥.";
      }
    });

    document.getElementById('btnClear').addEventListener('click', () => {
      emailEl.value=""; passEl.value=""; clearMsgs(); emailEl.focus();
    });
  </script>
</body>
</html>